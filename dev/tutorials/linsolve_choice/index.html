<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Advanced usage · CurveFit.jl</title><meta name="title" content="Advanced usage · CurveFit.jl"/><meta property="og:title" content="Advanced usage · CurveFit.jl"/><meta property="twitter:title" content="Advanced usage · CurveFit.jl"/><meta name="description" content="Documentation for CurveFit.jl."/><meta property="og:description" content="Documentation for CurveFit.jl."/><meta property="twitter:description" content="Documentation for CurveFit.jl."/><meta property="og:url" content="https://docs.sciml.ai/CurveFit/stable/tutorials/linsolve_choice/"/><meta property="twitter:url" content="https://docs.sciml.ai/CurveFit/stable/tutorials/linsolve_choice/"/><link rel="canonical" href="https://docs.sciml.ai/CurveFit/stable/tutorials/linsolve_choice/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CurveFit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started/">Getting started with CurveFit.jl</a></li><li class="is-active"><a class="tocitem" href>Advanced usage</a><ul class="internal"><li><a class="tocitem" href="#Why-does-linear-solver-choice-matter"><span>Why does linear solver choice matter</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Choosing-the-right-solver"><span>Choosing the right solver</span></a></li><li><a class="tocitem" href="#When-to-customize"><span>When to customize</span></a></li></ul></li><li><a class="tocitem" href="../stats/">StatsAPI interface usage</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/overview/">Basic overview</a></li><li><a class="tocitem" href="../../basics/problems/">Problem types</a></li><li><a class="tocitem" href="../../basics/solvers/">Solvers</a></li><li><a class="tocitem" href="../../basics/solutions/">Solutions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Advanced usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Advanced usage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/CurveFit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/CurveFit.jl/blob/master/docs/src/tutorials/linsolve_choice.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Advanced-usage"><a class="docs-heading-anchor" href="#Advanced-usage">Advanced usage</a><a id="Advanced-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-usage" title="Permalink"></a></h1><p>This tutorial covers advanced options for improving curve fitting performance by controlling the linear solvers used internally by nonlinear algorithms. It is intended for users who want more control over numerical stability, performance, or problem structure. NonlinearSolve.jl provides the user with the option to choose the linear solver they want for the Levenber-Marquardt algorithm.</p><h2 id="Why-does-linear-solver-choice-matter"><a class="docs-heading-anchor" href="#Why-does-linear-solver-choice-matter">Why does linear solver choice matter</a><a id="Why-does-linear-solver-choice-matter-1"></a><a class="docs-heading-anchor-permalink" href="#Why-does-linear-solver-choice-matter" title="Permalink"></a></h2><p>The Levenberg–Marquardt algorithm work by repeatedly solving linear systems involving the Jacobian matrix. At each iteration, systems of the form:</p><p class="math-container">\[    (J^T \cdot J + \lamda \cdot I)\delta = J^T \cdot r\]</p><p>must be solved. <code>J</code> is the Jacobian matrix and <code>r</code> the residual vector.</p><p>The numerical properties of these systems depend strongly on the structure and conditioning of the Jacobian. While NonlinearSolve.jl selects a reasonable  default, explicitly choosing a linear solver can significantly improve robustness  or performance in some cases.</p><p>Inside the <code>LevenbergMarquardt</code> constructor the keyword argument <code>linsolve</code> specifies the linear solver used in the algorithm. By default it is set to nothing and in that  case NonlinearSolve.jl will choose a linear solver on its own. Users can pass their desired linear solver to the constructor in which case that will be the one used. Below is a simple example of how to pass a specific linear solver.    </p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><pre><code class="language-julia hljs">using CurveFit
using NonlinearSolve

X = collect(1.0:10.0)
θ_true = [3.0, 1.5, 0.5]

function f(θ, X)
    return @. θ[1] + θ[2] * exp(θ[3] * X)
end
Y = f(θ_true, X)

nonf = NonlinearFunction(f)
alg = LevenbergMarquardt(linsolve = QRFactorization())

prob = NonlinearCurveFitProblem(nonf, [2.1, 3.3, 0.1], X, Y)
sol = solve(prob, alg)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CurveFitSolution{CurveFit.__FallbackNonlinearFitAlgorithm{GeneralizedFirstOrderAlgorithm{Missing, NonlinearSolveFirstOrder.LevenbergMarquardtTrustRegion{Float64}, GeodesicAcceleration{DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}, Float64, Float64}, Nothing, Nothing, Nothing, Nothing, Val{true}}}, Vector{Float64}, Vector{Float64}, CurveFitProblem{Vector{Float64}, Vector{Float64}, NonlinearFunction{false, SciMLBase.FullSpecialize, typeof(Main.f), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Nothing, Nothing}, Vector{Float64}}, SciMLBase.NonlinearSolution{Float64, 1, Vector{Float64}, Vector{Float64}, NonlinearLeastSquaresProblem{Vector{Float64}, false, Vector{Float64}, NonlinearFunction{false, SciMLBase.FullSpecialize, CurveFit.NonlinearFunctionWrapper{false, Vector{Float64}, typeof(Main.f)}, LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Vector{Float64}, Nothing}, Base.Pairs{Symbol, Union{}, Nothing, @NamedTuple{}}, Nothing, Nothing}, GeneralizedFirstOrderAlgorithm{Missing, NonlinearSolveFirstOrder.LevenbergMarquardtTrustRegion{Float64}, GeodesicAcceleration{DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}, Float64, Float64}, Nothing, AutoForwardDiff{nothing, Nothing}, AutoFiniteDiff{Val{:forward}, Val{:forward}, Val{:hcentral}, Nothing, Nothing, Bool}, AutoForwardDiff{nothing, Nothing}, Val{true}}, Nothing, Nothing, SciMLBase.NLStats, NonlinearSolveBase.NonlinearSolveTrace{Val{false}, Val{false}, Nothing, NonlinearSolveBase.NonlinearSolveTracing{Val{:minimal}}, NonlinearLeastSquaresProblem{Vector{Float64}, false, Vector{Float64}, NonlinearFunction{false, SciMLBase.FullSpecialize, CurveFit.NonlinearFunctionWrapper{false, Vector{Float64}, typeof(Main.f)}, LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Vector{Float64}, Nothing}, Base.Pairs{Symbol, Union{}, Nothing, @NamedTuple{}}, Nothing, Nothing}}}}(CurveFit.__FallbackNonlinearFitAlgorithm{GeneralizedFirstOrderAlgorithm{Missing, NonlinearSolveFirstOrder.LevenbergMarquardtTrustRegion{Float64}, GeodesicAcceleration{DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}, Float64, Float64}, Nothing, Nothing, Nothing, Nothing, Val{true}}}(GeneralizedFirstOrderAlgorithm{Missing, NonlinearSolveFirstOrder.LevenbergMarquardtTrustRegion{Float64}, GeodesicAcceleration{DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}, Float64, Float64}, Nothing, Nothing, Nothing, Nothing, Val{true}}(missing, NonlinearSolveFirstOrder.LevenbergMarquardtTrustRegion{Float64}(1.0), GeodesicAcceleration{DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}, Float64, Float64}(DampedNewtonDescent{QRFactorization{LinearAlgebra.NoPivot}, Float64, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}}(QRFactorization{LinearAlgebra.NoPivot}(LinearAlgebra.NoPivot(), 16, true), 1.0, NonlinearSolveFirstOrder.LevenbergMarquardtDampingFunction{Float64, Float64, Float64}(2.0, 3.0, 1.0e-8)), 0.1, 0.75), nothing, 9223372036854775807, nothing, nothing, nothing, Val{true}(), :LevenbergMarquardt)), [2.9999999999994964, 1.5000000000001166, 0.49999999999999084], [-3.339550858072471e-13, -2.611244553918368e-13, -1.6697754290362354e-13, -4.618527782440651e-14, 7.815970093361102e-14, 1.8474111129762605e-13, 1.8474111129762605e-13, -1.2789769243681803e-13, -1.1937117960769683e-12, -3.581135388230905e-12], CurveFitProblem{Vector{Float64}, Vector{Float64}, NonlinearFunction{false, SciMLBase.FullSpecialize, typeof(Main.f), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Nothing, Nothing}, Vector{Float64}}([1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0], [5.473081906050192, 7.077422742688568, 9.722533605507097, 14.083584148395975, 21.27374094105521, 33.1283053847815, 52.673177938038464, 84.89722504971635, 138.02569695078273, 225.61973865386489], NonlinearFunction{false, SciMLBase.FullSpecialize, typeof(Main.f), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Nothing, Nothing}(Main.f, LinearAlgebra.UniformScaling{Bool}(true), nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, nothing, SciMLBase.DEFAULT_OBSERVED_NO_TIME, nothing, nothing, nothing, nothing), [2.1, 3.3, 0.1]), SciMLBase.ReturnCode.StalledSuccess, [2.9999999999994964, 1.5000000000001166, 0.49999999999999084])</code></pre><h2 id="Choosing-the-right-solver"><a class="docs-heading-anchor" href="#Choosing-the-right-solver">Choosing the right solver</a><a id="Choosing-the-right-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-the-right-solver" title="Permalink"></a></h2><p>As a general guideline:</p><ul><li>QR-based factorization is recommended for ill-conditioned or</li></ul><p>rank-deficient problems. It is robust and numerically-stable. Slower than cholesky factorization.</p><ul><li>Cholesky-based factorization is efficient for well-conditioned</li></ul><p>problems and for symmetric positive definite matrices. Faster than qr factorization, but can be unstable.</p><ul><li>LU-based factorization falls somewhere in between QR and Cholesky</li></ul><p>factorization. Can be used, although the other two are usually better.</p><ul><li>Default solver is usually a decent choice, unless some structural</li></ul><p>information about the problem is known which can be exploited.</p><h2 id="When-to-customize"><a class="docs-heading-anchor" href="#When-to-customize">When to customize</a><a id="When-to-customize-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-customize" title="Permalink"></a></h2><p>Custom solver selection is most useful when:</p><ul><li><p>Fits fail to converge due to numerical instability</p></li><li><p>Jacobians are poorly conditioned</p></li><li><p>Problem structure (dense, sparse, symmetric) is known in advance</p></li><li><p>Performance becomes critical for large problems</p></li></ul><p>In most cases, the default choice is more than enough, but advanced users can benefit from this additional level of control.</p><p>For more detail see:</p><ul><li><a href="https://docs.sciml.ai/LinearSolve/stable/">LinearSolve.jl</a></li><li><a href="https://docs.sciml.ai/NonlinearSolve/stable/">NonlinearSolve.jl</a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../getting_started/">« Getting started with CurveFit.jl</a><a class="docs-footer-nextpage" href="../stats/">StatsAPI interface usage »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 5 January 2026 17:21">Monday 5 January 2026</span>. Using Julia version 1.12.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
